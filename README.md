<p align="center">

<img src="./images/microsoft-azure-logo.png" width="400" />
</p>

<h1>Network Security Groups (NSGs) and Inspecting Traffic Between Azure Virtual Machines</h1>
In this lab, we used Wireshark to observe network traffic between Azure virtual machines and validated how Network Security Groups affect connectivity. By generating ICMP, SSH, DHCP, DNS, and RDP traffic, we correlated system commands with their underlying network protocols and observed how NSG rules directly control packet flow. This lab demonstrates practical Azure networking, traffic inspection, and basic cloud security concepts. <br />


<!--
<h2>Video Demonstration</h2>

- ### [YouTube: Azure Virtual Machines, Wireshark, and Network Security Groups](https://www.youtube.com)
-->

<h2>Environments and Technologies Used</h2>

<p align="left">
<img src="https://skillicons.dev/icons?i=azure,windows,powershell" /> <img src="https://img.icons8.com/?size=50&id=rOHcpTUtCTjr&format=png&color=000000" /></p>



- Microsoft Azure (Virtual Machines/Compute)
- Remote Desktop
- Various Command-Line Tools
- Various Network Protocols (SSH, RDH, DNS, HTTP/S, ICMP)
- Wireshark (Protocol Analyzer)

<h2>Operating Systems Used </h2>

- Windows 10 (22H2)
- Ubuntu Server 24.04

<h2>High-Level Steps</h2>

<img src="images/WireShark Traffic.gif" width="400" alt="Wireshark Traffic" />

- Step 1. Azure Environment Setup
- Step 2. ICMP Traffic Inspection
- Step 3. NSG Rule Observation
- Step 4. SSH, DHCP, DNS & RDP Traffic Observation

> **Note:** Each step includes written instructions followed by a corresponding screenshot.<br>Expand the **See screenshots** section to view the images.

<h2>Actions and Observations</h2>

<b>1. AZURE SETUP</b>
 - Create a Resource Group, name it "rg-ad-lab".
 - Create VM, name it vm-client-1, "Windows 10 Enterprise, version 22H2 - x64 Gen 2" for image, for size, select any with 2 VCPUs and 16gb Ram, create your VM Client 1 credentials, mark checkbox for Licensing, continue to Networking> settings, create new vnet and name it "vnet-ad-lab", select Default subnet. Finally, select "Review + Create" and "Create".
 - Create Linux VM, name it vm-linux, "Ubuntu Server 24.04 LTS - x64 Gen 2" for image, for size, select any with 2 VCPUs and 16gb Ram, select Password for Authication type, create your VM Linux credentials, continue to Networking> settings, select our earler VNet named "vnet-ad-lab", select Default subnet. Finally, select "Review + Create" and "Create". 

<b>2. TRAFFIC INSPECTION AND SET UP</b>

RDP into our "vm-client-1" machine, download and install wireshark, keep only default settings as prompted in installation. Open Wireshark and select the active network interface (Ethernet). In the "Apply a display filter" field, type "icmp" and press Enter. Open PowerShell and Ping the private IP Address of "vm-linux". 
```powershell
ping <Linux Private IP>
```
Observe the traffic in Wireshark. We filtered by ICMP to isolate and observe the echo request and reply packets generated by the ping test.

<details><summary>See screenshots</summary>

<img src="images/Step 2a.png" width="60%">

</details> 

<p>Inspect the data packet in Wireshark, under Internet Control Message Protocal drop down, and Data drop down, select the Data.</p>



<details><summary>See screenshots</summary>

<img src="images/Step 2b.png" width="60%">
</details>

>**Note:** On the right, you can see the ICMP payload, which often contains a predictable ASCII test pattern (such as the alphabet) used by the ping utility for easy identification during packet inspection.</P>


<b>3. NETWORK SECURITY GROUP RULE AND TRAFFIC OBSERVATION</b>

In PowerShell on "vm-client-1" create a perpetual ping.
```powershell
ping <Linux Private IP> -t
```
Go back to our Azure portal and view the list of VMs. Select "vm-linux", on the left pane, select "Network Settings", under Network security group, select "vm-linux-nsg". In the left pane, under Settings, select "Inbound security rules".
Select "+ Add" near the top, to add our new rule. Create and add the rule with the following settings.
- Destination port ranges: *
- Protocol: ICMPv4
- Action: Deny
- Priority: 290
- Name: BlockICMP

<details><summary>See screenshots</summary>

<img src="images/Step 3a.jpg" width="30%">
</details>


<p>Observe the terminal and Wireshark output. Notice the "No Response Found!" in Wireshark, and "Request timed out." message in PowerShell.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 3b.png" width="60%">
</details>

<p>Re-enable ICMP Traffic by deleting the created rule in Azure, and insepect our network traffic in the terminal and Wireshark.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 3c.png" width="60%">
</details>

<p>Back to normal. In PowerShell, press `Ctrl+C` to stop the continous ping.</P>

<b>4. SSH TRAFFIC OBSERVATION</b>

Back in our client VM "vm-client-1" in Wireshark, clear the filter and filter for SSH traffic, type "SSH" in the "Apply a display filter" field. Now lets create a SSH Session between the Client VM and Domain Controller VM. In PowerShell, type the following,
```powershell
ssh <linux username>@<linux private IP>
```
In the following prompt, type yes and press Enter.
Next, enter your Linux user password. Note: No characters will appear on the screen while you type, this is normal behavior for security reasons. Press Enter when finished.

Observe the traffic within Wireshark.

<details><summary>See screenshots</summary>

<img src="images/Step 4a.png" width="60%">
</details> 

<p>In PowerShell, enter Commands such as id, hostname, uname, and pwd, and observe Wireshark again.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 4b.png" width="60%">
</details> 

<p>Exit SSH by typing "Exit" in PowerShell.</p>

<b>5. DHCP TRAFFIC OBSERVATION</b>
<p>Back in Wireshark, filter for DHCP traffic (udp.port == 67 || udp.port == 68). In PowerShell, run ipconfig/ renew.  Observe DHCP traffic in Wireshark.</p>

<details><summary>See screenshots</summary>

<img src="images/Step 5.png" width="60%">
</details> 

<b>6. DNS TRAFFIC OBSERVATION</b>

Back in Wireshark, filter for DNS traffic (DNS or udp.port == 53 || tcp.port == 53). In PowerShell use nslookup for www.google.com.
```powershell
nslookup google.com
```

<details><summary>See screenshots</summary>

<img src="images/Step 6.png" width="60%">
</details>

<b>7. RDP TRAFFIC OBSERVATION</b>
<p>Back in Wireshark, filter for RDP traffic (tcp.port == 3389).  Review the data stream from our Remote Desktop Connection from the local machine to the virtual machine!</p>

<details><summary>See screenshots</summary>

<img src="images/Step 7.png" width="60%">
</details> 


